name: Simple Deployment Test Release branch

on:
  push:
    branches: 
      - 'release/*' 
  workflow_dispatch: 

jobs:
  deploy-qa:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to QA
        run: |
          echo "ğŸš€ Deploying to QA environment..."
          echo "âœ… QA deployment completed!"
      
      - name: Notify QA Complete
        run: |
          echo "ğŸ“¢ QA deployment finished"
          echo "ğŸ”” Ready for staging approval"

  request-staging-approval:
    needs: deploy-qa
    runs-on: ubuntu-latest
    environment: stage  # This gives access to stage environment secrets
    steps:
      - name: Send Slack Approval Request
        uses: khimananda/slack-approval@main
        env:
          SLACK_APP_TOKEN: ${{ secrets.SLACK_APP_TOKEN }}
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          SLACK_SIGNING_SECRET: ${{ secrets.SLACK_SIGNING_SECRET }}
          SLACK_CHANNEL_ID: ${{ secrets.SLACK_CHANNEL_ID }}
        timeout-minutes: 10

  deploy-staging:
    needs: [deploy-qa, request-staging-approval]
    runs-on: ubuntu-latest
    environment: stage 
    steps:
      - name: Deploy to Staging
        run: |
          echo "ğŸ‰ Deploying to STAGING environment..."
          echo "âœ… Staging deployment completed!"
      
      - name: Notify Staging Complete
        run: |
          echo "ğŸŠ Staging deployment finished!"
          echo "ğŸŒ Application is live on staging!"
