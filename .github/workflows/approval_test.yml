name: Simple Deployment Test Release branch

on:
  push:
    branches: 
      - 'release/*' 
  workflow_dispatch: 

jobs:
  deploy-qa:
    runs-on: ubuntu-latest
    environment: stage  # Added to access your Slack secrets
    steps:
      - name: Deploy to QA
        run: |
          echo "ğŸš€ Deploying to QA environment..."
          echo "âœ… QA deployment completed!"
      
      - name: Send QA Complete + Approval Request Notification
        run: |
          curl -X POST https://slack.com/api/chat.postMessage \
          -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
          -H "Content-Type: application/json" \
          -d '{
          "channel": "${{ secrets.SLACK_CHANNEL_ID }}",
          "text": "âœ… *QA DEPLOYMENT COMPLETED*\n\nğŸ”” **APPROVAL REQUEST**: Staging deployment needs your approval\n\nğŸ“¦ Repository: ${{ github.repository }}\nğŸŒ¿ Branch: `${{ github.ref_name }}`\n\nğŸ”— **Approval URL**: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}\n\nâ³ Click the link above to approve staging deployment"
          }'

  deploy-staging:
    needs: deploy-qa
    runs-on: ubuntu-latest
    environment: stage 
    steps:
      - name: Deploy to Staging
        run: |
          echo "ğŸ‰ Deploying to STAGING environment..."
          echo "âœ… Staging deployment completed!"
      
      - name: Notify Staging Complete
        run: |
          echo "ğŸŠ Staging deployment finished!"
          echo "ğŸŒ Application is live on staging!"
      
      - name: Send Slack Success Notification
        run: |
          curl -X POST https://slack.com/api/chat.postMessage \
          -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
          -H "Content-Type: application/json" \
          -d '{
          "channel": "${{ secrets.SLACK_CHANNEL_ID }}",
          "text": "ğŸ‰ *STAGING DEPLOYMENT SUCCESSFUL!*\n\nğŸ“¦ Repository: ${{ github.repository }}\nğŸŒ¿ Branch: `${{ github.ref_name }}`\nâœ… Status: Live & Ready\nğŸŒ Staging environment is now updated!"
          }'
